montageDefine("7a1ec3b","composer/key-composer",{dependencies:["../core/core","./composer"],factory:function(t,a){var e=t("../core/core").Montage,l=t("./composer").Composer,s="keyPress",c="longKeyPress",n="keyRelease",i=a.KeyComposer=l.specialize({_isLoaded:{value:!1},_shouldDispatchEvent:{value:!1},shouldDispatchLongPress:{value:!1},_longPressTimeout:{value:null},_keyRegistered:{value:!1},_keys:{value:null},keys:{get:function(){return this._keys},set:function(t){this._keyRegistered?(o.defaultKeyManager.unregisterKey(this),this._keys=t,o.defaultKeyManager.registerKey(this)):this._keys=t}},load:{value:function(){this._isLoaded=!0,this._shouldDispatchEvent&&!this._keyRegistered&&(o.defaultKeyManager.registerKey(this),this._keyRegistered=!0)}},unload:{value:function(){this._isLoaded=!1,o.defaultKeyManager.unregisterKey(this),this._keyRegistered=!1}},addEventListener:{value:function(t,a,e){var i=this.component;l.addEventListener.call(this,t,a,e),(t==s||t==c||t==n)&&(this._shouldDispatchEvent=!0,t==c&&(this._shouldDispatchLongPress=!0),this._isLoaded?this._keyRegistered||(o.defaultKeyManager.registerKey(this),this._keyRegistered=!0):i&&"function"!=typeof i.addComposer&&(this.element||(this.element=window),this.load()))}},constructor:{value:function(){l.constructor.call(this)}},deserializedFromTemplate:{value:function(){var t=this.component;null===this.identifier&&(this.identifier=e.getInfoForObject(this).label),t&&("function"==typeof t.addComposer?t.addComposer(this):this._isLoaded||(this.element||(this.element=window),this.load()))}}},{createKey:{value:function(t,a,e){var l=this;return this===i&&(l=new i),e||(e=t.identifier?t.identifier+a.toLowerCase().replace(/[ +]/g).toCapitalized():a.toLowerCase().replace(/[ +]/g)),l.keys=a,l.identifier=e,t.addComposer(l),l}},createGlobalKey:{value:function(t,a,e){var l=this;return this===i&&(l=new i),l.keys=a,l.identifier=e,t.addComposerForElement(l,window),l}}}),r=null,o=e.specialize({_defaultKeyManager:{value:null},_loadingDefaultKeyManager:{value:!1},_keysToRegister:{value:[]},constructor:{value:function(){}},registerKey:{value:function(a){var e=this;this._defaultKeyManager?this._defaultKeyManager.registerKey(a):(this._keysToRegister.push(a),this._loadingDefaultKeyManager||(this._loadingDefaultKeyManager=!0,t.async("core/event/key-manager").then(function(t){var a=e._defaultKeyManager=t.defaultKeyManager;e._keysToRegister.forEach(function(t){a.registerKey(t)}),e._keysToRegister.length=0}).done()))}},unregisterKey:{value:function(t){this._defaultKeyManager&&this._defaultKeyManager.unregisterKey(t)}}},{defaultKeyManager:{get:function(){return r||(r=new o),this._defaultKeyManager?this._defaultKeyManager:r}}})}});