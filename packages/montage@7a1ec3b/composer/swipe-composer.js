var Montage=require("../core/core").Montage,Composer=require("./composer").Composer;exports.SwipeComposer=Composer.specialize({load:{value:function(){document.addEventListener("touchstart",this,!0)}},unload:{value:function(){document.removeEventListener("touchstart",this,!0)}},_startX:{enumerable:!1,value:0},_startY:{enumerable:!1,value:0},_deltaX:{enumerable:!1,value:0},_deltaY:{enumerable:!1,value:0},_threshold:{enumerable:!1,value:50},_thresholdSwipeAngle:{enumerable:!1,value:20},_startTimestamp:{enumerable:!1,value:0},captureTouchstart:{value:function(t){this._reset();var a=t.touches,e=a[0];this._startX=e.clientX,this._startY=e.clientY,this._startTimestamp=t.timeStamp,document.addEventListener("touchmove",this,!0),document.addEventListener("touchend",this,!0),document.addEventListener("touchcancel",this,!0)}},_reset:{enumerable:!1,value:function(){this._startX=0,this._startY=0,this._deltaX=0,this._deltaY=0,this._startSwipeAngle=null}},_startSwipeAngle:{enumerable:!1,value:null},captureTouchcancel:{value:function(){document.removeEventListener("touchmove",this,!0),document.removeEventListener("touchend",this,!0),document.removeEventListener("touchcancel",this,!0)}},captureTouchmove:{value:function(t){t.preventDefault();var a,e,l=t.changedTouches[0];this._deltaX=l.clientX-this._startX,this._deltaY=l.clientY-this._startY;var s=this._deltaX,n=this._deltaY,c=this._threshold,i=this._findSwipeAngle(s,n);null!=this._startSwipeAngle&&Math.abs(this._startSwipeAngle-i)>this._thresholdSwipeAngle&&(this._startSwipeAngle=null),null==this._startSwipeAngle&&(this._startSwipeAngle=i,this._startX=l.clientX,this._startY=l.clientY,this._deltaX=0,this._deltaY=0),s>c&&n>c?e="DIAGONAL":s>c&&c>n?e=this._deltaX>0?"RIGHT":"LEFT":c>s&&n>c&&(e=this._deltaY>0?"DOWN":"UP"),(0!=s||0!=n)&&(a=document.createEvent("CustomEvent"),a.initCustomEvent("swipemove",!0,!1,null),a.direction=e,a.angle=this._startSwipeAngle,a.velocity=this._findVelocity(t.timeStamp-this._startTimestamp),a.startX=this._startX,a.startY=this._startY,a.dX=this._deltaX,a.dY=this._deltaY,this.dispatchEvent(a))}},_findSwipeAngle:{enumerable:!1,value:function(t,a){var e=-1*(180*Math.atan2(a,t)/3.14);return e.toFixed(2)}},captureTouchend:{value:function(t){if(null!=t){var a,e,l=Math.abs(this._deltaX),s=Math.abs(this._deltaY),n=this._threshold;if(n>l&&n>s)return this.captureTouchcancel(),void 0;document.removeEventListener("touchmove",this,!0),l>n&&s>n?a="DIAGONAL":l>n&&n>s?a=this._deltaX>0?"RIGHT":"LEFT":n>l&&s>n&&(a=this._deltaY>0?"DOWN":"UP"),e=document.createEvent("CustomEvent"),e.initCustomEvent("swipe",!0,!1,null),e.direction=a,e.angle=this._startSwipeAngle,e.velocity=this._findVelocity(t.timeStamp-this._startTimestamp),e.startX=this._startX,e.startY=this._startY,e.dX=this._deltaX,e.dY=this._deltaY,this.dispatchEvent(e)}}},_findVelocity:{enumerable:!1,value:function(t){return Math.sqrt(this._deltaX*this._deltaX+this._deltaY*this._deltaY)/t}}});