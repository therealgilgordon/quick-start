var Montage=require("../../core/core").Montage,TranslateComposer=require("../../composer/translate-composer").TranslateComposer,defaultEventManager=require("../../core/event/event-manager").defaultEventManager,Point=require("../../core/geometry/point").Point,convertPointFromPageToNode=require("../../core/dom").convertPointFromPageToNode,FlowTranslateComposer=exports.FlowTranslateComposer=TranslateComposer.specialize({constructor:{value:function(){this.super(),this.handleMousewheel=this.handleWheel}},stealChildrenPointer:{value:!0},_scrollingMode:{value:"linear"},scrollingMode:{get:function(){return this._scrollingMode},set:function(e){switch(e){case"linear":case"drag":this._scrollingMode=e}}},_linearScrollingVector:{value:[-300,0]},linearScrollingVector:{get:function(){return this._linearScrollingVector},set:function(e){this._linearScrollingVector=e}},_startPageX:{value:null},_startPageY:{value:null},_pageX:{value:null},_pageY:{value:null},_pointerStartX:{value:null},_pointerStartY:{value:null},_contentOffsetX:{value:null},_contentOffsetY:{value:null},_start:{value:function(e,t){TranslateComposer._start.apply(this,arguments);var n=window.getComputedStyle(this._element,null),i=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("border-left-width")),r=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("border-top-width")),a=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("padding-left")),s=this.convertCssPixelsPropertyStringToNumber(n.getPropertyValue("padding-top")),o=convertPointFromPageToNode(this._element,(new Point).init(e,t));this._pointerStartX=this._pointerX=o.x-i-a,this._pointerStartY=this._pointerY=o.y-r-s,this._contentOffsetX=this._startPageX-this._pointerStartX,this._contentOffsetY=this._startPageY-this._pointerStartY,this._computePointedElement(),this._startPageX=this._pageX=e,this._startPageY=this._pageY=t,this._startScroll=this._scroll,this._previousScrollDelta=0,this._scrollEnd=null}},_analyzeMovement:{value:function(e){var t,n,i,r=e.velocity;r&&(t=r.speed,t>=this.startTranslateSpeed?this._stealPointer():(n=this.startPageX-e.pageX,i=this.startPageY-e.pageY,n*n+i*i>this.startTranslateRadius*this.startTranslateRadius&&this._stealPointer()))}},_dispatchTranslateStart:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateStart",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslateCancel:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateCancel",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.scroll=this._scroll,e.translateX=0,e.translateY=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_move:{value:function(e,t){this._isFirstMove&&(this._dispatchTranslateStart(),this._isFirstMove=!1),this._pageX=e,this._pageY=t,"drag"===this._scrollingMode?(this._pointerX=e-this._contentOffsetX,this._pointerY=t-this._contentOffsetY,this._updateDragScroll()):this._updateLinearScroll(),null!==this._closerIndex,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_end:{value:function(e){this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(this.startTime=Date.now(),this.endX=this.startX=this._pageX,this.endY=this.startY=this._pageY,this._hasMomentum&&(e.velocity.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!=this._axis?e.velocity.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!=this._axis?e.velocity.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX+this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY+this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||this._dispatchTranslateEnd()),this._releaseInterest()}},_translateEndTimeout:{value:null},_mousewheelStrideTimeout:{value:null},_previousDeltaY:{value:0},handleWheel:{value:function(e){var t=this;if(this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this.component)){var n=this._pageY,i=e.wheelDeltaY||-e.deltaY||0;this.translateStrideX?(window.clearTimeout(this._mousewheelStrideTimeout),(null===this._mousewheelStrideTimeout||Math.abs(i)>Math.abs(this._previousDeltaY*(null===this._mousewheelStrideTimeout?2:4)))&&(i>1?this.callDelegateMethod("previousStride",this):-1>i&&this.callDelegateMethod("nextStride",this)),this._mousewheelStrideTimeout=window.setTimeout(function(){t._mousewheelStrideTimeout=null,t._previousDeltaY=0},70),t._previousDeltaY=i,this._shouldPreventDefault(e)&&e.preventDefault()):(null===this._translateEndTimeout&&this._dispatchTranslateStart(),this._pageY=this._pageY+20*i/100,this._updateScroll(),this._dispatchTranslate(),window.clearTimeout(this._translateEndTimeout),this._translateEndTimeout=window.setTimeout(function(){t._dispatchTranslateEnd(),t._translateEndTimeout=null},400),n!==this._pageY&&this._shouldPreventDefault(e)&&e.preventDefault()),this.eventManager.forfeitPointer(this._WHEEL_POINTER,this.component)}}},_scroll:{value:0},scroll:{get:function(){return this._scroll},set:function(e){null!==this.minScroll&&this.minScroll>e&&(e=this.minScroll),null!==this.maxScroll&&e>this.maxScroll&&(e=this.maxScroll),this._scroll=e}},minScroll:{value:null},maxScroll:{value:null},_flow:{value:null},flow:{get:function(){return this._flow},set:function(e){this._flow=e,this.component=e}},_updateScroll:{value:function(){"linear"===this._scrollingMode?this._updateLinearScroll():this._updateDragScroll()}},_updateLinearScroll:{value:function(){var e=500/this._flow._height,t=(this._pageX-this._startPageX)*this._linearScrollingVector[0]*e,n=(this._pageY-this._startPageY)*this._linearScrollingVector[1]*e,i=this._linearScrollingVector[0]*this._linearScrollingVector[0]+this._linearScrollingVector[1]*this._linearScrollingVector[1],r=(t+n)/i;this.scroll+=r-this._previousScrollDelta,this._previousScrollDelta=r}},_updateDragScroll:{value:function(){var e=(this._pointerX-this._pointerStartX)*this._lineVectorX,t=(this._pointerY-this._pointerStartY)*this._lineVectorY,n=this._lineVectorX*this._lineVectorX+this._lineVectorY*this._lineVectorY,i=(e+t)/n;this.scroll+=i-this._previousScrollDelta,this._previousScrollDelta=i;var r,a,s,o,l,c,u,h,d,p,g,m,v,f,L,_,b,y,C,w,M=this._flow,x=M._cameraPosition,z=M._splinePaths,E=z.length,S=this._closerIndex%E,P=this.flow._splinePaths[S],T=Math.floor(this._closerIndex/E)-this._scroll+this._flow._paths[S].headOffset,D=null,O=null,A=0,B=.5*this._element.clientWidth,k=.5*this._element.clientHeight,e=B-this._pointerX,t=k-this._pointerY,j=M.cameraTargetPoint[0]-x[0],I=M.cameraTargetPoint[1]-x[1],R=M.cameraTargetPoint[2]-x[2],N=-Math.atan2(j,R),F=this._pointerIntersectionPosition;g=R*Math.cos(N)-j*Math.sin(N),m=-Math.atan2(I,g),_=Math.sin(N),b=Math.cos(N),y=Math.sin(m),C=Math.cos(m),f=k/Math.tan(.008726646259972*M.cameraFov),w=0,u=1e100;do p=P._convertSplineTimeToBezierIndexTime(T+w),null!==p&&(r=P.getPositionAtIndexTime(p),rotation=z[S].getRotationAtIndexTime(p),v=this._rotateXYZ(F,rotation),a=(x[2]-r[2]-v[2])*_-(r[0]-x[0]+v[0])*b,s=r[1]-x[1]+v[1],o=(r[2]-x[2]+v[2])*b-(r[0]-x[0]+v[0])*_,l=o*y+s*C,c=o*C-s*y,L=f/c,a=e+a*L,s=t+l*L,d=a*a+s*s,u>d&&(u=d,D=w)),w-=.025;while(w>-6);D+.025>0&&(D=-.025),w=D+.025,u=1e100;do p=P._convertSplineTimeToBezierIndexTime(T+w),null!==p&&(r=P.getPositionAtIndexTime(p),rotation=z[S].getRotationAtIndexTime(p),v=this._rotateXYZ(F,rotation),a=(x[2]-r[2]-v[2])*_-(r[0]-x[0]+v[0])*b,s=r[1]-x[1]+v[1],o=(r[2]-x[2]+v[2])*b-(r[0]-x[0]+v[0])*_,l=o*y+s*C,c=o*C-s*y,L=f/c,a=e+a*L,s=t+l*L,d=a*a+s*s,u>d&&(u=d,D=w)),w-=2e-4;while(w>D-.05);w=0,h=1e100;do p=P._convertSplineTimeToBezierIndexTime(T+w),null!==p&&(r=P.getPositionAtIndexTime(p),rotation=z[S].getRotationAtIndexTime(p),v=this._rotateXYZ(F,rotation),a=(x[2]-r[2]-v[2])*_-(r[0]-x[0]+v[0])*b,s=r[1]-x[1]+v[1],o=(r[2]-x[2]+v[2])*b-(r[0]-x[0]+v[0])*_,l=o*y+s*C,c=o*C-s*y,L=f/c,a=e+a*L,s=t+l*L,d=a*a+s*s,h>d&&(h=d,O=w)),w+=.025;while(6>w);0>O-.025&&(O=.025),w=O-.025,h=1e100;do p=P._convertSplineTimeToBezierIndexTime(T+w),null!==p&&(r=P.getPositionAtIndexTime(p),rotation=z[S].getRotationAtIndexTime(p),v=this._rotateXYZ(F,rotation),a=(x[2]-r[2]-v[2])*_-(r[0]-x[0]+v[0])*b,s=r[1]-x[1]+v[1],o=(r[2]-x[2]+v[2])*b-(r[0]-x[0]+v[0])*_,l=o*y+s*C,c=o*C-s*y,L=f/c,a=e+a*L,s=t+l*L,d=a*a+s*s,h>d&&(h=d,O=w)),w+=2e-4;while(O+.05>w);D?A=O?O*O>D*D?D:O:D:O&&(A=O),A>0?.05>=A&&(this.scroll=this._scroll-A):A>=-.05&&(this.scroll=this._scroll-A)}},frame:{value:function(){this.isAnimating&&this._animationInterval()}},convertCssPixelsPropertyStringToNumber:{value:function(e){return"string"==typeof e?"px"===e.substr(-2)?1*e.substr(0,e.length-2):0:0}},_rayPointDistance:{value:function(e,t){var n,i,r,a,s;return n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n>=0?(i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n/=i,r=e[0]*n-t[0],a=e[1]*n-t[1],s=e[2]*n-t[2],Math.sqrt(r*r+a*a+s*s)):!1}},_rayRectangleIntersection:{value:function(e,t,n,i){var r,a,s,o,l,c=e[1]*i[2]-e[2]*i[1],u=e[2]*i[0]-e[0]*i[2],h=e[0]*i[1]-e[1]*i[0],d=n[0]*c+n[1]*u+n[2]*h,p=1e-10,g=!1;return-p>d?(r=-t[0]*c-t[1]*u-t[2]*h,0>r&&r>d&&(s=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],a=e[0]*s+e[1]*o+e[2]*l,0>a&&a>d&&(g=(i[0]*s+i[1]*o+i[2]*l)/d,0>g&&(g=!1)))):d>p&&(r=-t[0]*c-t[1]*u-t[2]*h,r>0&&d>r&&(s=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],a=e[0]*s+e[1]*o+e[2]*l,a>0&&d>a&&(g=(i[0]*s+i[1]*o+i[2]*l)/d,0>g&&(g=!1)))),g}},_rayRectangleIntersectionPosition:{enumerable:!1,value:function(e,t,n,i){var r,a,s,o,l,c=e[1]*i[2]-e[2]*i[1],u=e[2]*i[0]-e[0]*i[2],h=e[0]*i[1]-e[1]*i[0],d=n[0]*c+n[1]*u+n[2]*h,p=this._flow._boundingBoxSize;return r=-t[0]*c-t[1]*u-t[2]*h,s=n[1]*t[2]-n[2]*t[1],o=n[2]*t[0]-n[0]*t[2],l=n[0]*t[1]-n[1]*t[0],a=e[0]*s+e[1]*o+e[2]*l,[r*p[0]/d-.5*p[0],a*p[1]/d-.5*p[1],0]}},_rotateXYZ:{enumerable:!1,value:function(e,t){var n,i,r,a,s=Math.cos(t[0]),o=Math.sin(t[0]),l=Math.cos(t[1]),c=Math.sin(t[1]),u=Math.cos(t[2]),h=Math.sin(t[2]);return i=s*e[1]-o*e[2],r=o*e[1]+s*e[2],a=l*e[0]+c*r,r=-c*e[0]+l*r,n=u*a-h*i,i=h*a+u*i,[n,i,r]}},_pointerIntersectionPosition:{enumerable:!1,value:null},_closerIndex:{enumerable:!1,value:null},_computePointedElement:{value:function(){var e=this._flow._splinePaths,t=e.length;if(t){var n,i,r,a,s,o,l,c,u,h=this._flow,d=h.cameraTargetPoint[0]-h.cameraPosition[0],p=h.cameraTargetPoint[2]-h.cameraPosition[2],g=Math.atan2(d,p),m=p*Math.cos(-g)-d*Math.sin(-g),v=Math.atan2(h.cameraTargetPoint[1]-h.cameraPosition[1],m),f=.5*this._element.clientWidth-this._pointerX,L=this._pointerY-.5*this._element.clientHeight,_=.5*this._element.offsetHeight/Math.tan(h.cameraFov*h._doublePI*(1/720)),b=[],y=h._visibleIndexes,C=y.length,w=null,M=1e100;for(i=_*Math.cos(v)-L*Math.sin(v),L=_*Math.sin(v)+L*Math.cos(v),n=i*Math.cos(g)-f*Math.sin(g),f=i*Math.sin(g)+f*Math.cos(g),l=[f,L,n],u=0;e.length>u;u++)b[u]=e[u].transform([1,0,0,0,0,1,0,0,0,0,1,0,-h.cameraPosition[0],-h.cameraPosition[1],-h.cameraPosition[2],1]);for(u=0;C>u;u++)c=this._flow.offset(y[u]),r=c.pathIndex,a=c.slideTime,o=b[r]._convertSplineTimeToBezierIndexTime(a),null!==o&&(pos=b[r].getPositionAtIndexTime(o),s=this._rayPointDistance(l,pos),s!==!1&&M>s&&(M=s,w=y[u]));this._closerIndex=w}}},test:{enumerable:!1,value:function(){var e,t,n,i,r,a,s,o,l,c,u=this._flow,h=this._bezierValue,d=u.cameraTargetPoint[0]-u.cameraPosition[0],p=u.cameraTargetPoint[1]-u.cameraPosition[1],g=u.cameraTargetPoint[2]-u.cameraPosition[2],m=Math.atan2(d,g),v=this._pointerX,f=this._pointerY;if(e=g*Math.cos(-m)-d*Math.sin(-m),t=Math.atan2(p,e),i=.5*this._element.clientWidth-v,r=f-.5*this._element.clientHeight,c=a=.5*this._element.offsetHeight/Math.tan(u.cameraFov*u._doublePI*(1/720)),l=a*Math.cos(t)-r*Math.sin(t),o=a*Math.sin(t)+r*Math.cos(t),s=i,a=l*Math.cos(m)-s*Math.sin(m),i=l*Math.sin(m)+s*Math.cos(m),r=o,this.t=n=this._raycastBezierTubes(u._cameraPosition[0],u._cameraPosition[1],u._cameraPosition[2],this._computeRotationValuesToXAxis(i,r,a)),null!==n[0]){var i,r,a,s,o,l,L,_,b,y,C,w=[u._splinePaths[n[0]]._knots[n[1]][0]-u._cameraPosition[0],u._splinePaths[n[0]]._knots[n[1]][1]-u._cameraPosition[1],u._splinePaths[n[0]]._knots[n[1]][2]-u._cameraPosition[2],u._splinePaths[n[0]]._nextHandlers[n[1]][0]-u._cameraPosition[0],u._splinePaths[n[0]]._nextHandlers[n[1]][1]-u._cameraPosition[1],u._splinePaths[n[0]]._nextHandlers[n[1]][2]-u._cameraPosition[2],u._splinePaths[n[0]]._previousHandlers[n[1]+1][0]-u._cameraPosition[0],u._splinePaths[n[0]]._previousHandlers[n[1]+1][1]-u._cameraPosition[1],u._splinePaths[n[0]]._previousHandlers[n[1]+1][2]-u._cameraPosition[2],u._splinePaths[n[0]]._knots[n[1]+1][0]-u._cameraPosition[0],u._splinePaths[n[0]]._knots[n[1]+1][1]-u._cameraPosition[1],u._splinePaths[n[0]]._knots[n[1]+1][2]-u._cameraPosition[2]],M=[];for(C=0;12>C;C+=3)M[0]=w[C+2]*Math.sin(-m)+w[C]*Math.cos(-m),M[1]=w[C+1],M[2]=w[C+2]*Math.cos(-m)-w[C]*Math.sin(-m),w[C]=M[0],w[C+1]=M[2]*Math.sin(-t)+M[1]*Math.cos(-t),w[C+2]=M[2]*Math.cos(-t)-M[1]*Math.sin(-t);a=h(w[2],w[5],w[8],w[11],n[2]),l=h(w[2],w[5],w[8],w[11],n[2]+1e-8),i=h(w[0],w[3],w[6],w[9],n[2])/a,s=h(w[0],w[3],w[6],w[9],n[2]+1e-8)/l,L=(s-i)*c/1e-8,r=h(w[1],w[4],w[7],w[10],n[2])/a,o=h(w[1],w[4],w[7],w[10],n[2]+1e-8)/l,dy=(o-r)*c/1e-8,_=Math.sqrt(L*L+dy*dy),b=Math.atan2(dy,L),y=u._splinePaths[n[0]]._densities[n[1]]*(1-n[2])+u._splinePaths[n[0]]._densities[n[1]+1]*n[2],this._lineVectorX=Math.cos(-b)*_/y,this._lineVectorY=Math.sin(-b)*_/y}}},_lineVectorX:{enumerable:!1,value:80*Math.cos(Math.PI-.6)},_lineVectorY:{enumerable:!1,value:80*Math.sin(Math.PI-.6)},_startX:{enumerable:!1,value:0},_startY:{enumerable:!1,value:0},_currentX:{enumerable:!1,value:0},_currentY:{enumerable:!1,value:0},_previousScrollDelta:{enumerable:!1,value:0},_startScroll:{enumerable:!1,value:0},_bezierValue:{enumerable:!1,value:function(e,t,n,i,r){var a=1-r;return e*a*a*a+3*t*a*a*r+3*n*a*r*r+i*r*r*r}},_computeRotationValuesToXAxis:{enumerable:!1,value:function(e,t,n){var i,r,a,s,o;return 1e-100>e*e&&(e=1e-50),i=e*e+t*t,r=Math.sqrt(i),a=1/r,o=e*a,s=-t*a,a=1/Math.sqrt(i+n*n),[s,o,-n*a,r*a]}},_infinite:{enumerable:!1,value:1e100},_sphereIntersection:{enumerable:!1,value:function(e,t){var n,i,r,a=e[0]*t[1]-e[1]*t[0],s=e[0]*t[0]+e[1]*t[1],o=a*t[2]+e[2]*t[3],l=e[3]*e[3];return l>=s*s+o*o?(n=a*t[3]-e[2]*t[2],i=Math.sqrt(l-s*s-o*o),r=n-i,0>r?0>n+i?this._infinite:0:r):this._infinite}},_bezierTubeBoundingSphere:{enumerable:!1,value:function(e,t){var n,i,r,a,s,o=e[0],l=e[1],c=e[2],u=e[0],h=e[1],d=e[2];return s=e[3],o>s?o=s:s>u&&(u=s),s=e[4],l>s?l=s:s>h&&(h=s),s=e[5],c>s?c=s:s>d&&(d=s),s=e[6],o>s?o=s:s>u&&(u=s),s=e[7],l>s?l=s:s>h&&(h=s),s=e[8],c>s?c=s:s>d&&(d=s),s=e[9],o>s?o=s:s>u&&(u=s),s=e[10],l>s?l=s:s>h&&(h=s),s=e[11],c>s?c=s:s>d&&(d=s),n=.5*(u-o),i=.5*(h-l),r=.5*(d-c),a=Math.sqrt(n*n+i*i+r*r)+t,[o+n,l+i,c+r,a]}},_raycastBezierTubes:{enumerable:!1,value:function(e,t,n,i){var r,a,s,o,l,c,u,h,d,p,g,m,v,f,L,_,b,y,C,w,M,x,z,E,S,P,T,D,O=[],A=this._infinite,B=null,k=0,j=null,I=0,R=this._flow._splinePaths;for(D=0;R.length>D;D++)for(T=0;R[D]._knots.length-1>T;T++)O[I]=[R[D]._knots[T][0]-e,R[D]._knots[T][1]-t,R[D]._knots[T][2]-n,R[D]._nextHandlers[T][0]-e,R[D]._nextHandlers[T][1]-t,R[D]._nextHandlers[T][2]-n,R[D]._previousHandlers[T+1][0]-e,R[D]._previousHandlers[T+1][1]-t,R[D]._previousHandlers[T+1][2]-n,R[D]._knots[T+1][0]-e,R[D]._knots[T+1][1]-t,R[D]._knots[T+1][2]-n,0,1048576,T,D],I++;for(T=I-1;T>=0;)u=O[T],h=.5*(u[0]+u[3]),d=.5*(u[3]+u[6]),p=.5*(u[6]+u[9]),f=.5*(u[1]+u[4]),L=.5*(u[4]+u[7]),_=.5*(u[7]+u[10]),w=.5*(u[2]+u[5]),M=.5*(u[5]+u[8]),x=.5*(u[8]+u[11]),g=.5*(h+d),m=.5*(d+p),v=.5*(g+m),b=.5*(f+L),y=.5*(L+_),C=.5*(b+y),z=.5*(w+M),E=.5*(M+x),S=.5*(z+E),P=u[13]>>1,s=[u[0],u[1],u[2],h,f,w,g,b,z,v,C,S,u[12],P,u[14],u[15]],r=this._bezierTubeBoundingSphere(s,this._flow._elementsBoundingSphereRadius),o=[v,C,S,m,y,E,p,_,x,u[9],u[10],u[11],u[12]+P,P,u[14],u[15]],a=this._bezierTubeBoundingSphere(o,this._flow._elementsBoundingSphereRadius),l=this._sphereIntersection(r,i),c=this._sphereIntersection(a,i),A>l?A>c?c>l?P?(O[T++]=o,O[T]=s):(A=l-1e-5,k=u[12],B=u[14],j=u[15],T--):P?(O[T++]=s,O[T]=o):(A=c-1e-5,k=u[12],B=u[14],j=u[15],T--):P?O[T]=s:(A=l-1e-5,k=u[12],B=u[14],j=u[15],T--):A>c?P?O[T]=o:(A=c-1e-5,k=u[12],B=u[14],j=u[15],T--):T--;return[j,B,k*(1/1048576)]}},_translateStride:{enumerable:!1,value:null},translateStride:{serializable:!0,get:function(){return this._translateStride},set:function(e){this._translateStride=e,this.translateStrideX=e}},startStrideTime:{enumerable:!1,value:null},_scrollEnd:{enumerable:!1,value:null},_scrollStart:{enumerable:!1,value:null},_hasMomentum:{enumerable:!1,value:!0},isLimitedToSingleStride:{value:!1},_animationInterval:{enumerable:!1,value:function(){var e,t,n,i,r,a,s=Date.now(),o=!1;r=this.minScroll,a=this.maxScroll,this.minScroll=null,this.maxScroll=null,null===this._scrollEnd&&(this._scrollStart=this.scroll,this._pageX=this.endX,this._pageY=this.endY,this._updateScroll(),this._scrollEnd=this.scroll,this.isLimitedToSingleStride&&this.translateStrideX&&(this._scrollEnd>Math.floor(this._scrollStart)+this.translateStrideX&&(this._scrollEnd=Math.floor(this._scrollStart)+this.translateStrideX),this._scrollEnd<Math.ceil(this._scrollStart)-this.translateStrideX&&(this._scrollEnd=Math.ceil(this._scrollStart)-this.translateStrideX)),this._pageX=this.startX,this._pageY=this.startY,this._updateScroll()),this.animateMomentum?(e=s-this.startTime,this.__momentumDuration>e?(this._pageX=this.startX+(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this._pageY=this.startY+(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this._updateScroll(),this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.scroll-this._scrollEnd)<.75*this.translateStrideX)&&(this.startStrideXTime=s,this._strideStartScroll=this._scroll)):this.animateMomentum=!1):null===this.startStrideXTime&&(this.startStrideXTime=this.startTime,this._strideStartScroll=this._scrollStart),i=this.scroll,this.startStrideXTime&&s-this.startStrideXTime>0&&(n=Math.round(this._scrollEnd/this.translateStrideX),s-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((s-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),t=(s-this.startStrideXTime)/this.translateStrideDuration,i=i*(1-t)+(n*this.translateStrideX*e+this._strideStartScroll*(1-e))*t,o=!0):(i=n*this.translateStrideX,this.animateMomentum=!1)),this.minScroll=r,this.maxScroll=a,r>i&&(i=r,this.animateMomentum=!1,o=!1),i>a&&(i=a,this.animateMomentum=!1,o=!1),this.scroll=i,this.isAnimating=this.animateMomentum||o,this.isAnimating?this.needsFrame=!0:(this._dispatchTranslateEnd(),this._scrollEnd=null)}}});