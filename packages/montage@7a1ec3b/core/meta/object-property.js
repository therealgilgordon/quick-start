"use strict";var Montage=require("../core").Montage,Exception=require("../exception").Exception,Blueprint=require("./blueprint").Blueprint,Binder=require("./blueprint").Binder,logger=require("../logger").logger("object-property"),ObjectProperty=exports.ObjectProperty=Montage.specialize({constructor:{value:function(){this.superForValue("constructor")()}},init:{serializable:!1,enumerable:!1,value:function(){return this}},apply:{value:function(t,e){if(!t.hasOwnProperty("blueprint")){var n;n=Montage.getInfoForObject(t),null!=n&&n.isInstance===!1&&(e===void 0?e=Binder.manager.blueprintForPrototype(n.objectName,n.moduleId):(e.prototypeName!==n.objectName||e.moduleId!==n.moduleId)&&(e=null),this.applyWithBlueprint(t,e))}}},applyWithBlueprint:{value:function(t,e){null!=e&&(this.addProperties(t,e),null!==e.parent&&this.apply(Object.getPrototypeOf(t),e))}},addProperties:{value:function(t,e){for(var n,a=0;n=e.propertyBlueprints[a++];)n.isDerived?this.addDerivedProperty(t,n):n.isAssociation?this.addAssociation(t,n):this.addProperty(t,n);Montage.defineProperty(t,"_blueprint",{serializable:!1,enumerable:!1,value:e}),Montage.defineProperty(t,"blueprint",{enumerable:!1,serializable:!1,get:function(){return this._blueprint}}),Montage.defineProperty(t,"blueprintGet",{serializable:!1,enumerable:!1,value:this.blueprintGet}),Montage.defineProperty(t,"blueprintSet",{serializable:!1,enumerable:!1,value:this.blueprintSet})}},addProperty:{value:function(t,e){this.addPropertyStorage(t,e),this.addPropertyDefinition(t,e),this.addPropertyStoredValue(t,e)}},addPropertyStorage:{value:function(t,e){var n="_"+e.name,a=null;t.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the storage value for "+n+"."):(a=e.isToMany?{value:[],enumerable:!1,serializable:!0,distinct:!0}:{value:null,enumerable:!1,serializable:!0},Montage.defineProperty(t,n,a))}},addPropertyDefinition:{value:function(t,e){var n=e.name,a=null;t.hasOwnProperty(n)?logger.isDebug&&logger.debug("The developer has already created the property "+n+" method do nothing."):(a={get:function(){return this.blueprintGet(n)},enumerable:!0,serializable:!1},e.readOnly||(a.set=function(t){return this.blueprintSet(n,t)}),Montage.defineProperty(t,n,a))}},blueprintGet:{value:function(t){var e=this.blueprint.propertyBlueprintForName(t),n="_"+e.name;return this[n]},enumerable:!1,serializable:!1},blueprintSet:{value:function(t,e){var n=this.blueprint.propertyBlueprintForName(t),a="_"+n.name;if(null==e&&n.denyDelete)throw(new Exception).initWithMessageTargetAndMethod("Deny Delete",this,n.name);this[a]=e},enumerable:!1,serializable:!1},addPropertyStoredValue:{value:function(t,e){var n=e.name+"$Storage",a=null;t.hasOwnProperty(n)?logger.isError&&logger.error("We have an issue here. The developer should not override the stored value for "+n+"."):(a=e.isToMany?{value:[],enumerable:!1,serializable:!1,distinct:!0}:{value:null,enumerable:!1,serializable:!1},Montage.defineProperty(t,n,a))}},addAssociation:{value:function(t,e){this.addPropertyStorage(t,e),this.addAssociationDefinition(t,e),this.addPropertyStoredValue(t,e)}},addAssociationDefinition:{value:function(t,e){e.isToMany?this.addToManyAssociationDefinition(t,e):this.addToOneAssociationDefinition(t,e)}},addToOneAssociationDefinition:{value:function(t,e){var n=e.name.toCapitalized(),a="addTo"+n;t.hasOwnProperty(a)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+a+"."):Montage.defineProperty(t,a,{serializable:!1,enumerable:!1,value:function(){return null}}),a="removeFrom"+n,t.hasOwnProperty(a)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+a+"."):Montage.defineProperty(t,a,{serializable:!1,enumerable:!1,value:function(){return null}}),a="clear"+n,t.hasOwnProperty(a)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+a+"."):Montage.defineProperty(t,a,{serializable:!1,enumerable:!1,value:function(){return null}})}},addToManyAssociationDefinition:{value:function(t,e){var n=e.name.toCapitalized(),a="addTo"+n;t.hasOwnProperty(a)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+a+"."):Montage.defineProperty(t,a,{serializable:!1,enumerable:!1,value:function(){return null}}),a="removeFrom"+n,t.hasOwnProperty(a)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+a+"."):Montage.defineProperty(t,a,{serializable:!1,enumerable:!1,value:function(){return null}}),a="clear"+n,t.hasOwnProperty(a)?logger.isError&&logger.error("We have an issue here. The developer should not override the method "+a+"."):Montage.defineProperty(t,a,{serializable:!1,enumerable:!1,value:function(){return null}})}},addDerivedProperty:{value:function(){}}});