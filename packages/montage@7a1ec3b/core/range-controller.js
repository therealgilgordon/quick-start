var Montage=require("./core").Montage,GenericCollection=require("collections/generic-collection"),RangeSelection=function(t,e){var n=t.clone();n.makeObservable(),n.rangeController=e,n.contentEquals=t&&t.contentEquals||Object.is,Object.defineProperty(n,"clone",{value:function(){return n.slice()}});var r=n.splice;return Object.defineProperty(n,"splice",{configurable:!1,value:function(t,e){var n=this.rangeController.content;this.contentEquals=n&&n.contentEquals||Object.is,t=t>=0?t:this.length+t;var a=this.length,i=Math.min(e,a-t),s=[].slice.call(arguments,2);s.contentEquals=this.contentEquals;var l,o=s.filter(function(e,r){if(n&&!n.has(e))return!1;if(s.findLast(e)>r)return!1;var a=this.find(e);return 0>a||a>=t&&t+i>a},this),c=Math.max(o.length,0),u=c-i,h=Math.max(a+u,t+c);if(!this.rangeController.multiSelect&&h>1){var p=c?o[c-1]:this.one();l=[0,a,p]}else l=this.rangeController.avoidsEmptySelection&&0===h?n.has(this[0])?[1,this.length-1]:[0,this.length,n.one()]:[t,e].concat(o);return r.apply(this,l)}}),n},RangeController=exports.RangeController=Montage.specialize({constructor:{value:function(t){this.content=null,this._selection=new RangeSelection([],this),this.sortPath=null,this.filterPath=null,this.visibleIndexes=null,this.reversed=!1,this.start=null,this.length=null,this.selectAddedContent=!1,this.deselectInvisibleContent=!1,this.clearSelectionOnOrderChange=!1,this.avoidsEmptySelection=!1,this.multiSelect=!1,this.organizedContent=[],this.organizedContent.addRangeChangeListener(this,"organizedContent"),this.defineBinding("_orderedContent",{"<-":"content.($filterPath.defined() ? filter{path($filterPath)} : ()).($sortPath.defined() ? sorted{path($sortPath)} : ()).($reversed ?? 0 ? reversed() : ())"}),this.defineBinding("organizedContent.rangeContent()",{"<-":"_orderedContent.($visibleIndexes.defined() ?$visibleIndexes.filter{<$_orderedContent.length}.map{$_orderedContent[()]} : ()).($start.defined() && $length.defined() ?view($start, $length) : ())"}),this.addRangeAtPathChangeListener("content",this,"handleContentRangeChange"),this.addPathChangeListener("sortPath",this,"handleOrderChange"),this.addPathChangeListener("reversed",this,"handleOrderChange"),this.addOwnPropertyChangeListener("multiSelect",this),this.iterations=[],t&&this.initWithContent(t)}},initWithContent:{value:function(t){return this.content=t,this}},sortPath:{value:null},reversed:{value:null},filterPath:{value:null},visibleIndexes:{value:null},start:{value:null},length:{value:null},selectAddedContent:{value:!1},deselectInvisibleContent:{value:!1},clearSelectionOnOrderChange:{value:!1},avoidsEmptySelection:{value:!1},multiSelect:{value:!1},_orderedContent:{value:null},organizedContent:{value:null},iterations:{value:null},_selection:{value:null},selection:{get:function(){return this._selection},set:function(t){var e=[0,this._selection.length];t&&t.toArray&&(e=e.concat(t.toArray())),this._selection.splice.apply(this._selection,e)}},select:{value:function(t){!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(t)}},deselect:{value:function(t){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection["delete"](t)}},clearSelection:{value:function(){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection.clear()}},add:{value:function(t){var e;return this.content||(this.content=[]),e=this.content.add(t),e&&this.handleAdd(t),e}},push:{value:function(){for(var t=this.content.push.apply(this.content,arguments),e=0;arguments.length>e;e++)this.handleAdd(arguments[e]);return t}},pop:{value:function(){return this.content.pop()}},shift:{value:function(){return this.content.shift()}},unshift:{value:function(){for(var t=this.content.unshift.apply(this.content,arguments),e=0;arguments.length>e;e++)this.handleAdd(arguments[e]);return t}},splice:{value:function(){for(var t=this.content.splice.apply(this.content,arguments),e=2;arguments.length>e;e++)this.handleAdd(arguments[e]);return t}},swap:{value:function(t,e,n){var r=this.content.swap.apply(this.content,arguments);if(n)for(var t=2;n.length>t;t++)this.handleAdd(n[t]);return r}},"delete":{value:function(t){return this.content["delete"](t)}},has:{value:function(t){return this.content?this.content.has(t):!1}},addEach:{value:GenericCollection.prototype.addEach},deleteEach:{value:GenericCollection.prototype.deleteEach},clear:{value:function(){this.content.clear()}},addContent:{value:function(){var t=new this.contentConstructor;return this.add(t),t}},_contentConstructor:{value:null},contentConstructor:{get:function(){return this._contentConstructor?this._contentConstructor:this.content&&this.content.contentConstructor?this.content.contentConstructor:Object},set:function(t){this._contentConstructor=t}},handleContentRangeChange:{value:function(t,e){if(this.selection.length>0){var n=this.content&&this.content.contentEquals||Object.is;e.deleteEach(t,n),this.selection&&this.selection.deleteEach(e)}}},handleSelectionRangeChange:{value:function(t,e){if(this.selection)if(this.content){for(var n=[],r=0;t.length>r;r++)this.content.has(t[r])||n.push(t[r]);if(this._selection.deleteEach(n),!this.multiSelect&&this._selection.length>1){var a=this._selection.pop();this._selection.clear(),this._selection.add(a)}this.avoidsEmptySelection&&0==this._selection.length&&this._selection.add(e[0])}else this._selection.clear()}},handleOrganizedContentRangeChange:{value:function(t,e){if(this.deselectInvisibleContent&&this.selection){var n=e.clone(1);n.deleteEach(t),this.selection.deleteEach(e)}}},handleOrderChange:{value:function(){this.clearSelectionOnOrderChange&&this.selection&&this.selection.clear()}},handleAdd:{value:function(t){this.selectAddedContent&&this.selection&&(!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(t))}},handleMultiSelectChange:{value:function(){if(this.selection){var t=this.selection.length;if(!this.multiSelect&&t>1){var e=this._selection.pop();this._selection.clear(),this._selection.add(e)}}}}},{blueprintModuleId:require("./core")._blueprintModuleIdDescriptor,blueprint:require("./core")._blueprintDescriptor});