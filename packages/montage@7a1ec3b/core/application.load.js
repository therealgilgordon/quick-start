montageDefine("7a1ec3b","core/application",{dependencies:["./core","./target","../window-loader/montage-window","./dom","./template"],factory:function(t,e){var a,s=(t("./core").Montage,t("./target").Target),n=t("../window-loader/montage-window").MontageWindow;t("./dom"),e.Application=s.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var t=this;t.parentApplication;)t=t.parentApplication;return t}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(t){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(t)&&(this._windowsSortOrder=t):this.mainApplication.windowsSortOrder=t}},windows:{get:function(){var t;if(null==this.parentApplication){if(!this._windows){var t=new n;t.application=this,t.window=window,this.window=t,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var t=new n;t.application=this,t.window=window,this._window=t}return this._window},set:function(t){this._window||(this._window=t)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(t){return t.defaultEventMananger}},focusWindow:{get:function(){var t=this.windows,e=this.windowsSortOrder;if("z-order"==e)return t[0];if("reverse-z-order"==e)return t[t.length-1];for(var a in t)if(t[a].focused)return t[a]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(t,e,a){var s,l,i=this,c=new n,r={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},o={module:t,name:e,parent:window,callback:function(t,e){var a;s=t.document.application,c.window=t,c.application=s,c.component=e,s.window=c,i.attachedWindows.push(c),a=i.mainApplication.windowsSortOrder,"z-order"==a||"reverse-open-order"==a?i.windows.unshift(c):i.windows.push(c),l=document.createEvent("CustomEvent"),l.initCustomEvent("load",!0,!0,null),c.dispatchEvent(l)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof a){var h,g,p="",d="";for(h in a)a.hasOwnProperty(h)&&(r[h]=a[h])}var L=["name"];for(h in r)-1==L.indexOf(h)&&(g=r[h],"boolean"==typeof g?g=g?"yes":"no":(g+="",g.match(/[ ,"]/)&&(g='"'+g.replace(/"/g,'\\"')+'"')),d+=p+h+"="+g,p=",");return window.require.loadPackage({name:"montage"}).then(function(t){var e=window.open(t.location+"window-loader/index.html","_blank",d);e.loadInfo=o}).done(),c}},attachWindow:{value:function(t){var e,a=t.application.parentApplication;return a!==this&&(a&&a.detachWindow(t),t.parentApplication=this,this.attachedWindows.push(t),e=this.mainApplication.windowsSortOrder,"z-order"==e||"reverse-open-order"==e?this.windows.unshift(t):this.windows.push(t),t.focus()),t}},detachWindow:{value:function(t){var e,a,s=this.windows;return void 0===t&&(t=this.window),a=t.application.parentApplication,a==this?(e=this.attachedWindows.indexOf(t),-1!==e&&this.attachedWindows.splice(e,1),e=s.indexOf(t),-1!==e&&s.splice(e,1),t.application.parentApplication=null):a&&a.detachWindow(t),t}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(a,s){var n,l=this;e.application=l,t.async("ui/component").then(function(e){return n=e.__root__,n.element=document,t("./template").instantiateDocument(window.document,a).then(function(){l.callDelegateMethod("willFinishLoading",l),n.needsDraw=!0,s&&s(l)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(t){return"alert"===t||"confirm"===t||"notify"===t}},_createPopupSlot:{value:function(t){var e=document.createElement("div");document.body.appendChild(e),e.style.zIndex=t,e.style.position="absolute";var s=new a;return s.element=e,s.attachToParentComponent(),s}},getPopupSlot:{value:function(e,s,n){var l=this;t.async("ui/slot.reel/slot").then(function(t){a=a||t.Slot,e=e||"custom";var i,c,r=l._isSystemPopup(e);if(l.popupSlots=l.popupSlots||{},r)switch(e){case"alert":i=9004;break;case"confirm":i=9003;break;case"notify":i=9002}else l._zIndex=l._zIndex?l._zIndex+1:7e3,i=l._zIndex;c=l.popupSlots[e],c||(c=l.popupSlots[e]=l._createPopupSlot(i)),r||(c.element.style.zIndex=i),c.content=s,n.call(this,c)}).done()}},returnPopupSlot:{value:function(t){var e=this;if(e.popupSlots&&e.popupSlots[t]){var a=e.popupSlots[t];a.content=null}}},_getActivePopupSlots:{value:function(){var t=[];if(this.popupSlots){var e=Object.keys(this.popupSlots);if(e&&e.length>0){var a,s=0,n=e.length;for(s=0;n>s;s++)a=this.popupSlots[e[s]],a&&null!==a.content&&t.push(a)}}return t}}})}});