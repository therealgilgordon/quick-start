montageDefine("7a1ec3b","core/media-controller",{dependencies:["./core","./target","./logger"],factory:function(t,e){t("./core").Montage;var n=t("./target").Target,a=t("./logger").logger("mediacontroller");e.MediaController=n.specialize({STOPPED:{value:0,writable:!1},PLAYING:{value:1,writable:!1},PAUSED:{value:2,writable:!1},EMPTY:{value:3,writable:!1},_TIMEUPDATE_FREQUENCY:{value:.25},_mediaController:{value:null},mediaController:{get:function(){return this._mediaController||(this._mediaController=new window.MediaController,this._installControlEventHandlers()),this._mediaController},set:function(t){this._mediaController!==t&&(this._mediaController&&this._removeControlEventHandlers(),this._mediaController=t,this._installControlEventHandlers())}},_status:{value:3},status:{get:function(){return this._status},set:function(t){t!==this._status&&(a.isDebug&&a.debug("MediaController:status: "+t),this._status=t)}},_position:{value:null},position:{set:function(t,e){this._position=t,e||(this._pauseTime=null,this.currentTime=t)},get:function(){return this._position}},_duration:{value:null},duration:{set:function(t){return isNaN(t)?(a.isDebug&&a.debug("MediaController:setDuration: duration is not valid"),void 0):(a.isDebug&&a.debug("MediaController:setDuration: duration="+t),this._duration=t,void 0)},get:function(){return this._duration}},autoplay:{value:!1},play:{value:function(){a.isDebug&&a.debug("MediaController:play()"),0!==this.mediaController.currentTime&&(this.mediaController.currentTime=0),this.mediaController.play(),this._pauseTime=null}},_pauseTime:{value:null},pause:{value:function(){a.isDebug&&a.debug("MediaController:pause()"),this._pauseTime=this.mediaController.currentTime,this.mediaController.pause()}},unpause:{value:function(){a.isDebug&&a.debug("MediaController:unpause()"),null!==this._pauseTime&&(this.mediaController.currentTime=this._pauseTime),this.mediaController.unpause()}},playPause:{value:function(){a.isDebug&&a.debug("MediaController:playPause()");var t=this.status===this.PLAYING,e=this.status===this.PAUSED;return this.playbackRate=this.mediaController.defaultPlaybackRate,t?this.pause():e?this.unpause():this.play(),!t}},_playbackRate:{value:1},playbackRate:{get:function(){return this._playbackRate},set:function(t){this._playbackRate!==t&&(this._playbackRate=t,this.mediaController.playbackRate=this._playbackRate)}},currentTime:{get:function(){return this.mediaController.currentTime},set:function(t){if(this.status!==this.EMPTY)try{if(isNaN(this.mediaController.duration))return a.error("MediaController:set currentTime: duration is not valid"),void 0;a.isDebug&&a.debug("current time: "+this.mediaController.currentTime+", new time: "+t);var e=this.mediaController.currentTime;e!==t&&(this.mediaController.currentTime=t)}catch(n){a.error("MediaController:Exception in set currentTime"+this.mediaController.currentTime)}}},rewind:{value:function(){this.status===this.PLAYING&&(a.isDebug&&a.debug("MediaController:rewind()"),this.playbackRate=-4)}},fastForward:{value:function(){this.status===this.PLAYING&&(a.isDebug&&a.debug("MediaController:fastForward()"),this.playbackRate=4)}},stop:{value:function(){a.isDebug&&a.debug("MediaController:stop()"),this.mediaController.pause(),this._pauseTime=null,this.status=this.STOPPED,this.position=0}},volume:{get:function(){return 100*this.mediaController.volume},set:function(t){var e=t;e===void 0?e=50:e>100?e=100:0>e&&(e=0),this.mediaController.volume=e/100}},volumeIncrease:{value:function(){this.volume+=10}},volumeDecrease:{value:function(){this.volume-=10}},toggleMute:{value:function(){this.mute=!this.mute}},mute:{get:function(){return this.mediaController.muted},set:function(t){t!==this.mediaController.muted&&(this.mediaController.muted=t)}},handleLoadedmetadata:{value:function(){return a.isDebug&&a.debug("MediaController:handleLoadedmetadata: PLAYING="+(this.status===this.PLAYING)+" duration="+this.mediaController.duration),isNaN(this.mediaController.duration)?(a.isDebug&&a.debug("MediaController:handleLoadedmetadata: duration is not valid"),void 0):(this.duration=this.mediaController.duration,this.autoplay?(a.isDebug&&a.debug("MediaController:handleLoadedmetadata: autoplay"),this.play()):this.status=this.STOPPED,void 0)}},_lastCurrentTime:{value:0},handleTimeupdate:{value:function(){if(this.status!==this.STOPPED){var t=this.mediaController.currentTime;Object.getPropertyDescriptor(this,"position").set.call(this,t,!0)}}},handlePlay:{value:function(){a.isDebug&&a.debug("MediaController:handlePlay"),this.status=this.PLAYING}},handlePlaying:{value:function(){a.isDebug&&a.debug("MediaController:handlePlaying: PLAYING"),this.status=this.PLAYING}},handlePause:{value:function(){this.status!==this.STOPPED?(a.isDebug&&a.debug("MediaController:handlePause: PAUSED"),this.status=this.PAUSED):a.isDebug&&a.debug("MediaController:handlePause: STOPPED")}},handleEnded:{value:function(){a.isDebug&&a.debug("MediaController:handleEnded"),this.mediaController.pause(),this.status=this.STOPPED}},handleAbort:{value:function(){a.isDebug&&a.debug("MediaController:handleAbort: STOPPED"),this.status=this.STOPPED}},handleError:{value:function(t){a.isDebug&&a.debug("MediaController:handleError: STOPPED");var e=t.target.error;if(this.status=this.STOPPED,e)switch(e.code){case e.MEDIA_ERR_ABORTED:console.error("You aborted the video playback.");break;case e.MEDIA_ERR_NETWORK:console.error("A network error caused the video download to fail part-way.");break;case e.MEDIA_ERR_DECODE:console.error("The video playback was aborted due to a corruption problem or because the video used features your browser did not support.");break;case e.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("The selected video could not be loaded, either because the server or network failed, the format is not supported, or no video has been selected.");break;default:console.error("An unknown error occurred.")}}},handleEmptied:{value:function(){a.isDebug&&a.debug("MediaController:handleEmptied: STOPPED"),this.status=this.STOPPED}},_installControlEventHandlers:{value:function(){this.mediaController.addEventListener("loadedmetadata",this),this.mediaController.addEventListener("timeupdate",this),this.mediaController.addEventListener("play",this),this.mediaController.addEventListener("playing",this),this.mediaController.addEventListener("pause",this),this.mediaController.addEventListener("abort",this),this.mediaController.addEventListener("error",this),this.mediaController.addEventListener("emptied",this),this.mediaController.addEventListener("ended",this)}},_removeControlEventHandlers:{value:function(){this.mediaController.removeEventListener("loadedmetadata",this),this.mediaController.removeEventListener("timeupdate",this),this.mediaController.removeEventListener("play",this),this.mediaController.removeEventListener("playing",this),this.mediaController.removeEventListener("pause",this),this.mediaController.removeEventListener("abort",this),this.mediaController.removeEventListener("error",this),this.mediaController.removeEventListener("emptied",this),this.mediaController.removeEventListener("ended",this)}},constructor:{value:function(){this.super()}}},{blueprintModuleId:t("./core")._blueprintModuleIdDescriptor,blueprint:t("./core")._blueprintDescriptor})}});